---
import BaseLayout from "../layouts/BaseLayout.astro";
---

<BaseLayout title="Screening CV" sideBarActiveItemID="cv">
Â  <section class="p-8 bg-gradient-to-br from-blue-100 via-white to-blue-50 rounded-2xl shadow-xl border border-blue-100">
Â  Â  <div class="mb-6 text-center">
Â  Â  Â  <h2 class="text-4xl font-extrabold text-blue-800 mb-2 flex items-center justify-center gap-2">
Â  Â  Â  Â  ğŸ“„ CV Screening AI
Â  Â  Â  </h2>
Â  Â  Â  <p class="text-gray-600 text-lg">
        Upload CV kamu (demo terbatas) dan biarkan sistem menganalisis kecocokan.
      </p>
Â  Â  </div>

Â  Â  <form
Â  Â  Â  id="screeningForm"
Â  Â  Â  class="space-y-6 max-w-2xl mx-auto bg-white p-6 rounded-xl shadow-md border border-gray-100"
Â  Â  Â  method="POST"
Â  Â  Â  enctype="multipart/form-data"
Â  Â  >
Â  Â  Â  <div>
Â  Â  Â  Â  <label class="block font-semibold text-gray-700 mb-2">Upload CV (PDF/DOCX):</label>
Â  Â  Â  Â  <div class="flex items-center gap-3 bg-gray-50 border border-gray-200 rounded-lg p-3 hover:border-blue-400 transition">
Â  Â  Â  Â  Â  <input
Â  Â  Â  Â  Â  Â  type="file"
Â  Â  Â  Â  Â  Â  id="cvFile"
Â  Â  Â  Â  Â  Â  name="cvFile"
Â  Â  Â  Â  Â  Â  accept=".pdf,.docx"
Â  Â  Â  Â  Â  Â  required
Â  Â  Â  Â  Â  Â  class="w-full text-sm text-gray-600 focus:outline-none"
             maxlength="500000"
Â  Â  Â  Â  Â  />
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <p class="text-xs text-gray-400 mt-1">*Maksimal 500KB. Hanya .pdf atau .docx.</p>
Â  Â  Â  </div>

Â  Â  Â  <div>
Â  Â  Â  Â  <label class="block font-semibold text-gray-700 mb-2">Job Description:</label>
Â  Â  Â  Â  <textarea
Â  Â  Â  Â  Â  id="jobDescription"
Â  Â  Â  Â  Â  name="jobDescription"
Â  Â  Â  Â  Â  rows="5"
Â  Â  Â  Â  Â  class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
Â  Â  Â  Â  Â  placeholder="Masukkan deskripsi pekerjaan yang ingin dianalisis..."
             maxlength="2000"
Â  Â  Â  Â  ></textarea>
        <p class="text-xs text-gray-400 mt-1">*Maksimal 2000 karakter.</p>
Â  Â  Â  </div>

      <input type="text" name="bot-field" style="display: none;" />

Â  Â  Â  <div class="text-center">
Â  Â  Â  Â  <button
Â  Â  Â  Â  Â  type="submit"
Â  Â  Â  Â  Â  class="px-6 py-2.5 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg shadow transition"
Â  Â  Â  Â  >
Â  Â  Â  Â  Â  ğŸ” Analyze CV
Â  Â  Â  Â  </button>
Â  Â  Â  </div>
Â  Â  </form>
Â  </section>

Â  <section
Â  Â  id="result"
Â  Â  class="mt-8 p-6 bg-white border border-gray-100 rounded-xl shadow-sm text-gray-800 max-w-2xl mx-auto hidden"
Â  ></section>

Â  <script>
    const form = document.getElementById("screeningForm");
    const resultDiv = document.getElementById("result");
    // Ambil referensi ke tombol submit
    const submitButton = form.querySelector('button[type="submit"]');

    form.addEventListener("submit", async (e) => {
        e.preventDefault();

        // 1. DISABLE TOMBOL
        submitButton.disabled = true;
        submitButton.innerHTML = 'â³ Analyzing...'; // Opsional: Beri feedback visual
        
        resultDiv.classList.remove("hidden");
        resultDiv.innerHTML = "â³ <b>Processing your CV analysis...</b>";

        const formData = new FormData(form);

        try {
            const res = await fetch("/api/screening", {
                method: "POST",
                body: formData,
            });

            const data = await res.json();

            if (!res.ok) {
                // Tampilkan pesan error (termasuk 429 Rate Limit)
                resultDiv.innerHTML = `
                    <p class="text-red-600 font-medium">âŒ Error: ${data.error || "Terjadi kesalahan pada server."}</p>
                `;
                throw new Error(data.error || "Failed to analyze CV.");
            }

            resultDiv.innerHTML = `
                <h3 class="text-xl font-bold text-blue-700 mb-2">ğŸ“Š Analysis Result</h3>
                <pre class="whitespace-pre-wrap bg-gray-50 border border-gray-200 p-4 rounded-lg text-sm">${data.result}</pre>
            `;
        } catch (err) {
            // Error handling sudah di dalam 'if (!res.ok)'
            console.error(err);
        } finally {
            // 2. ENABLE TOMBOL KEMBALI SETELAH PROSES SELESAI
            submitButton.disabled = false;
            submitButton.innerHTML = 'ğŸ” Analyze CV'; // Kembalikan teks tombol
        }
    });
</script>
</BaseLayout>